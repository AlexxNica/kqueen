"use strict";function topology_graph(t,e,n){function r(t){p=t,M.selectAll("g").classed("selected",function(e){return e.item===t})}function a(){x=null,c=s.node().clientWidth,u=s.node().clientHeight,k.size([c,u]),M.attr("viewBox","0 0 "+c+" "+u),i()}function i(){A=M.selectAll("line").data(h),A.exit().remove(),A.enter().insert("line",":first-child"),A.attr("class",function(t){return t.kinds}),b=M.selectAll("g").data(y,function(t){return t.id}),b.exit().remove();var t=b.enter().append("g").call(w);return r(p),k.nodes(y).links(h).start(),t}function o(){var t=y,e=g;y=[],h=[],g={};var n,r,a,o;for(r in f)n=f[r],a=n.kind,l&&!l[a]||(o=t[e[r]],o||(o=cache[r],delete cache[r],o||(o={})),o.id=r,o.item=n,g[r]=y.length,y.push(o));var d,s,m,x,p;for(d=0,s=v.length;d<s;d++)m=v[d],x=g[m.source],p=g[m.target],void 0!==x&&void 0!==p&&h.push({source:x,target:p,kinds:y[x].item.kind+y[p].item.kind});return c&&u?i():d3.select()}function d(){window.clearTimeout(x),x=window.setTimeout(a,150)}var c,u,s=d3.select(t),l=e.kinds,f=e.items,v=e.relations,m=20;n.radius&&(m=n.radius);var x,y=[],h=[],g={},p=null,k=n.force;k||(k=d3.layout.force().charge(-800).gravity(.2).linkDistance(80));var w=k.drag(),M=s.append("svg").attr("viewBox","0 0 1600 1200").attr("preserveAspectRatio","xMidYMid meet").attr("class","kube-topology"),b=d3.select(),A=d3.select();return k.on("tick",function(){A.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),b.attr("cx",function(t){return t.x=t.fixed?t.x:Math.max(m,Math.min(c-m,t.x)),t.x}).attr("cy",function(t){return t.y=t.fixed?t.y:Math.max(m,Math.min(u-m,t.y)),t.y}).attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}),w.on("dragstart",function(t){!0!==t.fixed&&(t.floatpoint=[t.x,t.y]),t.fixed=!0,d3.select(this).classed("fixed",!0)}).on("dragend",function(t){var e=!0;t.floatpoint&&(e=t.x<t.floatpoint[0]-5||t.x>t.floatpoint[0]+5||t.y<t.floatpoint[1]-5||t.y>t.floatpoint[1]+5,delete t.floatpoint),t.fixed=e&&t.x>3&&t.x<c-3&&t.y>=3&&t.y<u-3,d3.select(this).classed("fixed",t.fixed)}),M.on("dblclick",function(){M.selectAll("g").classed("fixed",!1).each(function(t){t.fixed=!1}),k.start()}).on("click",function(t){d3.select(d3.event.target).datum()}),window.addEventListener("resize",d),a(),d(),{select:r,kinds:function(t){l=t;var e=o();return[b,e]},data:function(t,e){f=t||{},v=e||[];var n=o();return[b,n]},close:function(){window.removeEventListener("resize",d),window.clearTimeout(x);var t,e;cache={};for(t in g)e=y[g[t]],delete e.item,cache[t]=e;y=[],g={}}}}function topology_data_transform(t){var e=[],n=t.reduce(function(t,e){return t[e.metadata.uid]=e,t},{}),r=void 0;for(r in n)if(r=n[r],"Pod"===r.kind){var a=!0,i=!1,o=void 0;try{for(var d,c=r.spec.containers[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var u=d.value,s=r.metadata.uid+"-"+u.name;n[s]={},n[s].metadata=u,n[s].kind="Container",e.push({target:s,source:r.metadata.uid})}}catch(t){i=!0,o=t}finally{try{!a&&c.return&&c.return()}finally{if(i)throw o}}}var l=void 0,f=void 0,v=!0,m=!1,x=void 0;try{for(var y,h=t[Symbol.iterator]();!(v=(y=h.next()).done);v=!0)if(l=y.value,f=l.kind,"Pod"===f&&function(){var n=l,r=t.find(function(t){return t.metadata.name===n.spec.nodeName});if(r?e.push({source:n.metadata.uid,target:r.metadata.uid}):console.log("Cannot found pods node!"),n.metadata.ownerReferences){var a=n.metadata.ownerReferences[0].uid,i=t.find(function(t){return t.metadata.uid===a});e.push({target:n.metadata.uid,source:i.metadata.uid})}else console.log("Cannot found owner references!");var o=t.find(function(t){if("Service"===t.kind&&t.spec.selector)return t.spec.selector.run===n.metadata.labels.run});e.push({target:n.metadata.uid,source:o.metadata.uid})}(),"Service"===f);}catch(t){m=!0,x=t}finally{try{!v&&h.return&&h.return()}finally{if(m)throw x}}return{items:n,relations:e}}var cache={};