"use strict";function topology_graph(t,e,n){function i(t){p=t,M.selectAll("g").classed("selected",function(e){return e.item===t})}function r(){g=null,l=s.node().clientWidth,d=s.node().clientHeight,k.size([l,d]),M.attr("viewBox","0 0 "+l+" "+d),a()}function a(){z=M.selectAll("line").data(m),z.exit().remove(),z.enter().insert("line",":first-child"),z.attr("class",function(t){return t.kinds}),A=M.selectAll("g").data(h,function(t){return t.id}),A.exit().remove();var t=A.enter().append("g").call(w);return i(p),k.nodes(h).links(m).start(),t}function o(){var t=h,e=y;h=[],m=[],y={};var n,i,r,o;for(i in f)n=f[i],r=n.kind,u&&!u[r]||(o=t[e[i]],o||(o=cache[i],delete cache[i],o||(o={})),o.id=i,o.item=n,y[i]=h.length,h.push(o));var c,s,v,g,p;for(c=0,s=x.length;c<s;c++)v=x[c],g=y[v.source],p=y[v.target],void 0!==g&&void 0!==p&&m.push({source:g,target:p,kinds:h[g].item.kind+h[p].item.kind});return l&&d?a():d3.select()}function c(){window.clearTimeout(g),g=window.setTimeout(r,150)}var l,d,s=d3.select(t),u=null,f={},x=[],v=20;n.radius&&(v=n.radius);var g,h=[],m=[],y={},p=null,k=n.force;k||(k=d3.layout.force().charge(-800).gravity(.2).linkDistance(80));var w=k.drag(),M=s.append("svg").attr("viewBox","0 0 1600 1200").attr("preserveAspectRatio","xMidYMid meet").attr("class","kube-topology"),A=d3.select(),z=d3.select();return k.on("tick",function(){z.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),A.attr("cx",function(t){return t.x=t.fixed?t.x:Math.max(v,Math.min(l-v,t.x)),t.x}).attr("cy",function(t){return t.y=t.fixed?t.y:Math.max(v,Math.min(d-v,t.y)),t.y}).attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}),w.on("dragstart",function(t){e(t.item),!0!==t.fixed&&(t.floatpoint=[t.x,t.y]),t.fixed=!0,d3.select(this).classed("fixed",!0)}).on("dragend",function(t){var e=!0;t.floatpoint&&(e=t.x<t.floatpoint[0]-5||t.x>t.floatpoint[0]+5||t.y<t.floatpoint[1]-5||t.y>t.floatpoint[1]+5,delete t.floatpoint),t.fixed=e&&t.x>3&&t.x<l-3&&t.y>=3&&t.y<d-3,d3.select(this).classed("fixed",t.fixed)}),M.on("dblclick",function(){M.selectAll("g").classed("fixed",!1).each(function(t){t.fixed=!1}),k.start()}).on("click",function(t){d3.select(d3.event.target).datum()||e(null)}),window.addEventListener("resize",c),r(),c(),{select:i,kinds:function(t){u=t;var e=o();return[A,e]},data:function(t,e){f=t||{},x=e||[];var n=o();return[A,n]},close:function(){window.removeEventListener("resize",c),window.clearTimeout(g);var t,e;cache={};for(t in y)e=h[y[t]],delete e.item,cache[t]=e;h=[],y={}}}}var cache={};