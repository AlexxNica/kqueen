"use strict";function topology_graph(e,t,n){function a(e){x=e,C.selectAll("g").classed("selected",function(t){return t.item===e})}function r(){v=null,s=d.node().clientWidth,l=d.node().clientHeight,k.size([s,l]),C.attr("viewBox","0 0 "+s+" "+l),i()}function i(){w=C.selectAll("line").data(y),w.exit().remove(),w.enter().insert("line",":first-child"),w.attr("class",function(e){return e.kinds}),S=C.selectAll("g").data(m,function(e){return e.id}),S.exit().remove();var e=S.enter().append("g").call(M);return a(x),k.nodes(m).links(y).start(),e}function o(){var e=m,t=g;m=[],y=[],g={};var n,a,r,o;for(a in f)n=f[a],r=n.kind,u&&!u[r]||(o=e[t[a]],o||(o=cache[a],delete cache[a],o||(o={})),o.id=a,o.item=n,g[a]=m.length,m.push(o));var c,d,h,v,x;for(c=0,d=p.length;c<d;c++)h=p[c],v=g[h.source],x=g[h.target],void 0!==v&&void 0!==x&&y.push({source:v,target:x,kinds:m[v].item.kind+m[x].item.kind});return s&&l?i():d3.select()}function c(){window.clearTimeout(v),v=window.setTimeout(r,150)}var s,l,d=d3.select(e),u=n.kinds,f=[],p=[],h=20;n.radius&&(h=n.radius);var v,m=[],y=[],g={},x=null,k=n.force;k||(k=d3.layout.force().charge(-60).linkDistance(100));var M=k.drag(),C=d.append("svg").attr("viewBox","0 0 1600 1200").attr("preserveAspectRatio","xMidYMid meet").attr("class","kube-topology"),S=d3.select(),w=d3.select();return k.on("tick",function(){w.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),S.attr("cx",function(e){return e.x=e.fixed?e.x:Math.max(h,Math.min(s-h,e.x)),e.x}).attr("cy",function(e){return e.y=e.fixed?e.y:Math.max(h,Math.min(l-h,e.y)),e.y}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"})}),M.on("dragstart",function(e){t(e.item),!0!==e.fixed&&(e.floatpoint=[e.x,e.y]),e.fixed=!0,d3.select(this).classed("fixed",!0)}).on("dragend",function(e){var t=!0;e.floatpoint&&(t=e.x<e.floatpoint[0]-5||e.x>e.floatpoint[0]+5||e.y<e.floatpoint[1]-5||e.y>e.floatpoint[1]+5,delete e.floatpoint),e.fixed=t&&e.x>3&&e.x<s-3&&e.y>=3&&e.y<l-3,d3.select(this).classed("fixed",e.fixed)}),C.on("dblclick",function(){C.selectAll("g").classed("fixed",!1).each(function(e){e.fixed=!1}),k.start()}).on("click",function(e){}),r(),c(),{select:a,kinds:function(e){u=e;var t=o();return[S,t]},data:function(e,t){f=e||{},p=t||[];var n=o();return[S,n]},close:function(){window.removeEventListener("resize",c),window.clearTimeout(v);var e,t;cache={};for(e in g)t=m[g[e]],delete t.item,cache[e]=t;m=[],g={}}}}function topology_data_transform(e){var t=[],n=e.reduce(function(e,t){return e[t.metadata.uid]=t,e},{}),a=void 0;for(a in n)if(a=n[a],"Pod"===a.kind){var r=!0,i=!1,o=void 0;try{for(var c,s=a.spec.containers[Symbol.iterator]();!(r=(c=s.next()).done);r=!0){var l=c.value,d=a.metadata.uid+"-"+l.name;n[d]={},n[d].metadata=l,n[d].kind="Container",t.push({target:d,source:a.metadata.uid})}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}var u=void 0,f=void 0,p=!0,h=!1,v=void 0;try{for(var m,y=e[Symbol.iterator]();!(p=(m=y.next()).done);p=!0)if(u=m.value,f=u.kind,"Pod"===f&&function(){var n=u,a=e.find(function(e){return e.metadata.name===n.spec.nodeName});if(a?t.push({source:n.metadata.uid,target:a.metadata.uid}):console.log("Cannot found pods node!"),n.metadata.ownerReferences){var r=n.metadata.ownerReferences[0].uid,i=e.find(function(e){return e.metadata.uid===r});t.push({target:n.metadata.uid,source:i.metadata.uid})}else console.log("Cannot found owner references!");var o=e.find(function(e){if("Service"===e.kind&&e.spec.selector)return e.spec.selector.run===n.metadata.labels.run});t.push({target:n.metadata.uid,source:o.metadata.uid})}(),"Service"===f);}catch(e){h=!0,v=e}finally{try{!p&&y.return&&y.return()}finally{if(h)throw v}}return{items:n,relations:t}}d3.hive={},d3.hive.link=function(){function e(e,r){var i,o=t(n,this,e,r),c=t(a,this,e,r);c.a<o.a&&(i=c,c=o,o=i),c.a-o.a>Math.PI&&(o.a+=2*Math.PI);var s=o.a+(c.a-o.a)/3,l=c.a-(c.a-o.a)/3;return o.r0-o.r1||c.r0-c.r1?"M"+Math.cos(o.a)*o.r0+","+Math.sin(o.a)*o.r0+"L"+Math.cos(o.a)*o.r1+","+Math.sin(o.a)*o.r1+"C"+Math.cos(s)*o.r1+","+Math.sin(s)*o.r1+" "+Math.cos(l)*c.r1+","+Math.sin(l)*c.r1+" "+Math.cos(c.a)*c.r1+","+Math.sin(c.a)*c.r1+"L"+Math.cos(c.a)*c.r0+","+Math.sin(c.a)*c.r0+"C"+Math.cos(l)*c.r0+","+Math.sin(l)*c.r0+" "+Math.cos(s)*o.r0+","+Math.sin(s)*o.r0+" "+Math.cos(o.a)*o.r0+","+Math.sin(o.a)*o.r0:"M"+Math.cos(o.a)*o.r0+","+Math.sin(o.a)*o.r0+"C"+Math.cos(s)*o.r1+","+Math.sin(s)*o.r1+" "+Math.cos(l)*c.r1+","+Math.sin(l)*c.r1+" "+Math.cos(c.a)*c.r1+","+Math.sin(c.a)*c.r1}function t(e,t,n,a){var s=e.call(t,n,a),l=+("function"==typeof r?r.call(t,s,a):r)+c,d=+("function"==typeof i?i.call(t,s,a):i);return{r0:d,r1:i===o?d:+("function"==typeof o?o.call(t,s,a):o),a:l}}var n=function(e){return e.source},a=function(e){return e.target},r=function(e){return e.angle},i=function(e){return e.radius},o=i,c=0;return e.source=function(t){return arguments.length?(n=t,e):n},e.target=function(t){return arguments.length?(a=t,e):a},e.angle=function(t){return arguments.length?(r=t,e):r},e.radius=function(t){return arguments.length?(i=o=t,e):i},e.startRadius=function(t){return arguments.length?(i=t,e):i},e.endRadius=function(t){return arguments.length?(o=t,e):o},e};var cache={},K8SVisualisations=function(e){return e.forcedChart=e.forcedChart||{},e.forcedChart.init=function(e,t,n){function a(e){c.select(e)}function r(e){return o[e.item.kind]}function i(e){var t=e.item.status;return!(!t||!t.phase||"Running"===t.phase)}if(n=n||{},!t)throw new Error("Cannot init K8S forced layout chart visualisation, invalid data given "+t);var o=(d3.select(e),{Pod:"#vertex-Pod",ReplicationController:"#vertex-ReplicationController",Node:"#vertex-Node",Service:"#vertex-Service",ReplicaSet:"#vertex-ReplicaSet",Container:"#vertex-Container",Deployment:"#vertex-Deployment",Namespace:"#vertex-Namespace"}),c=topology_graph(e,a,{kinds:o});!function(e){var t=e[0],a=e[1];a.attr("class",function(e){return e.item.kind}),a.append("use").attr("xlink:href",r),a.append("title"),n.hasOwnProperty("nodeClickFn")&&"function"==typeof n.nodeClickFn&&t.on("click",n.nodeClickFn),t.selectAll("title").text(function(e){return e.item.metadata.name}),t.classed("weak",i),c.select()}(c.data(t.items,t.relations))},e}(K8SVisualisations||{}),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Math.radians=function(e){return e*Math.PI/180},Math.degrees=function(e){return 180*e/Math.PI};var K8SVisualisations=function(e){return e.hiveChart=e.hiveChart||{},e.hiveChart.init=function(e,t,n){if(n=n||{},!t)throw new Error("Cannot init K8S hive chart visualisation, invalid data given "+t);var a=n.width||960,r=n.height||600,i=n.outerRadius||400,o=n.innerRadius||40,c=[{x:0,angle:30,radius:420,name:"Pods",kind:"Pod"},{x:1,angle:270,radius:200,name:"Nodes",kind:"Node"},{x:2,angle:150,radius:240,name:"Services",kind:"Service"},{x:3,angle:210,radius:240,name:"Deployments",kind:"Deployment"},{x:4,angle:90,radius:240,name:"Namespaces",kind:"Namespace"}],s={Pod:"#vertex-Pod",ReplicationController:"#vertex-ReplicationController",Node:"#vertex-Node",Service:"#vertex-Service",ReplicaSet:"#vertex-ReplicaSet",Container:"#vertex-Container",Deployment:"#vertex-Deployment",Namespace:"#vertex-Namespace"},l={Pod:0,Node:0,Service:0,Deployment:0,Namespace:0,Container:0},d={Pod:0,Node:1,Service:2,Deployment:3,Namespace:4,Container:5},u={Pod:d3.scale.linear().range([o,420]),Node:d3.scale.linear().range([o,200]),Service:d3.scale.linear().range([o,240]),Deployment:d3.scale.linear().range([o,240]),Namespace:d3.scale.linear().range([o,240])};"object"===_typeof(t.items)&&(t.items=Object.values(t.items));var f=function(e){return e.map(function(e){return e.id=e.metadata.uid,e.name=e.metadata.name||"Unnamed node",["Pod","Service","Node","Deployment","Namespace"].indexOf(e.kind)<0&&(e.kind="Other"),e.x=d[e.kind],l[e.kind]++,e.y=l[e.kind],e})}(t.items),p={Service:1/l.Service,Pod:1/l.Pod,Node:1/l.Node,Deployment:1/l.Deployment,Namespace:1/l.Namespace},h=function(e,t){return t.map(function(t){var n={};return e.forEach(function(e){t.source==e.id?n.source=e:t.target==e.id&&(n.target=e)}),n.hasOwnProperty("source")&&n.hasOwnProperty("target")||(console.log("Cannot found relation node for link "+t),n=t),n})}(f,t.relations),v=function(e){var t=0,n=!1;return c.forEach(function(a){e.kind==a.kind&&(t=a.angle,n=!0)}),n||console.log("Cannot compute angle for item "+e.kind+e.metadata.name),t},m=(d3.scale.linear().range([o,i]),function(e){return s[e]}),y={linkOver:function(e){g.selectAll(".link").classed("active",function(t){return t===e}),g.selectAll(".node circle").classed("active",function(t){return t===e.source||t===e.target}),g.selectAll(".node text").classed("active",function(t){return t===e.source||t===e.target})},nodeOver:function(e){g.selectAll(".link").classed("active",function(t){return t.source===e||t.target===e}),d3.select(this).select("circle").classed("active",!0),d3.select(this).select("text").classed("active",!0),x.html("Node - "+e.name+"<br/>Kind - "+e.kind).style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px"),x.transition().duration(200).style("opacity",.9)},out:function(e){g.selectAll(".active").classed("active",!1),x.transition().duration(500).style("opacity",0)}},g=d3.select(e).append("svg").attr("width",a).attr("height",r).append("g").attr("transform","translate("+(a/2-180)+","+(r/2-20)+")"),x=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),k=g.selectAll(".node").data(c).enter().append("g");k.append("line").attr("class","axis").attr("transform",function(e){return"rotate("+e.angle+")"}).attr("x1",function(e){return u[e.kind].range()[0]}).attr("x2",function(e){return u[e.kind].range()[1]}),k.append("text").attr("class","axis-label").attr("font-size","16px").attr("font-family","Open Sans").attr("text-anchor","middle").attr("alignment-baseline","central").text(function(e){return e.name}).attr("transform",function(e){return"translate("+(u[e.kind].range()[1]+30)*Math.cos(Math.radians(e.angle))+", "+(u[e.kind].range()[1]+30)*Math.sin(Math.radians(e.angle))+")"}),g.selectAll(".link").data(h).enter().append("path").attr("class","link").attr("d",d3.hive.link().angle(function(e){return Math.radians(v(e))}).radius(function(e){return u[e.kind](e.y*p[e.kind]-.1)})).on("mouseover",y.linkOver).on("mouseout",y.out);var M=g.selectAll(".node").data(f).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+u[e.kind](e.y*p[e.kind]-.1)*Math.cos(Math.radians(v(e)))+", "+u[e.kind](e.y*p[e.kind]-.1)*Math.sin(Math.radians(v(e)))+")"}).on("mouseover",y.nodeOver).on("mouseout",y.out);n.hasOwnProperty("nodeClickFn")&&"function"==typeof n.nodeClickFn&&M.on("click",n.nodeClickFn),M.append("use").attr("xlink:href",function(e){return m(e.kind)})},e}(K8SVisualisations||{});