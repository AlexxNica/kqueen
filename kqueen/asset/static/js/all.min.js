"use strict";function topology_graph(t,e,n){function a(t){x=t,w.selectAll("g").classed("selected",function(e){return e.item===t})}function r(){m=null,s=l.node().clientWidth,d=l.node().clientHeight,k.size([s,d]),w.attr("viewBox","0 0 "+s+" "+d),i()}function i(){S=w.selectAll("line").data(y),S.exit().remove(),S.enter().insert("line",":first-child"),S.attr("class",function(t){return t.kinds}),C=w.selectAll("g").data(v,function(t){return t.id}),C.exit().remove();var t=C.enter().append("g").call(M);return a(x),k.nodes(v).links(y).start(),t}function o(){var t=v,e=g;v=[],y=[],g={};var n,a,r,o;for(a in f)n=f[a],r=n.kind,u&&!u[r]||(o=t[e[a]],o||(o=cache[a],delete cache[a],o||(o={})),o.id=a,o.item=n,g[a]=v.length,v.push(o));var c,l,h,m,x;for(c=0,l=p.length;c<l;c++)h=p[c],m=g[h.source],x=g[h.target],void 0!==m&&void 0!==x&&y.push({source:m,target:x,kinds:v[m].item.kind+v[x].item.kind});return s&&d?i():d3.select()}function c(){window.clearTimeout(m),m=window.setTimeout(r,150)}var s,d,l=d3.select(t),u=n.kinds,f=[],p=[],h=20;n.radius&&(h=n.radius);var m,v=[],y=[],g={},x=null,k=n.force;k||(k=d3.layout.force().charge(-60).linkDistance(100));var M=k.drag(),w=l.append("svg").attr("viewBox","0 0 1600 1200").attr("preserveAspectRatio","xMidYMid meet").attr("class","kube-topology"),C=d3.select(),S=d3.select();return k.on("tick",function(){S.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),C.attr("cx",function(t){return t.x=t.fixed?t.x:Math.max(h,Math.min(s-h,t.x)),t.x}).attr("cy",function(t){return t.y=t.fixed?t.y:Math.max(h,Math.min(d-h,t.y)),t.y}).attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}),M.on("dragstart",function(t){e(t.item),!0!==t.fixed&&(t.floatpoint=[t.x,t.y]),t.fixed=!0,d3.select(this).classed("fixed",!0)}).on("dragend",function(t){var e=!0;t.floatpoint&&(e=t.x<t.floatpoint[0]-5||t.x>t.floatpoint[0]+5||t.y<t.floatpoint[1]-5||t.y>t.floatpoint[1]+5,delete t.floatpoint),t.fixed=e&&t.x>3&&t.x<s-3&&t.y>=3&&t.y<d-3,d3.select(this).classed("fixed",t.fixed)}),w.on("dblclick",function(){w.selectAll("g").classed("fixed",!1).each(function(t){t.fixed=!1}),k.start()}).on("click",function(t){}),r(),c(),{select:a,kinds:function(t){u=t;var e=o();return[C,e]},data:function(t,e){f=t||{},p=e||[];var n=o();return[C,n]},close:function(){window.removeEventListener("resize",c),window.clearTimeout(m);var t,e;cache={};for(t in g)e=v[g[t]],delete e.item,cache[t]=e;v=[],g={}}}}function topology_data_transform(t){var e=[],n=t.reduce(function(t,e){return t[e.metadata.uid]=e,t},{}),a=void 0;for(a in n)if(a=n[a],"Pod"===a.kind){var r=!0,i=!1,o=void 0;try{for(var c,s=a.spec.containers[Symbol.iterator]();!(r=(c=s.next()).done);r=!0){var d=c.value,l=a.metadata.uid+"-"+d.name;n[l]={},n[l].metadata=d,n[l].kind="Container",e.push({target:l,source:a.metadata.uid})}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}var u=void 0,f=void 0,p=!0,h=!1,m=void 0;try{for(var v,y=t[Symbol.iterator]();!(p=(v=y.next()).done);p=!0)if(u=v.value,f=u.kind,"Pod"===f&&function(){var n=u,a=t.find(function(t){return t.metadata.name===n.spec.nodeName});if(a?e.push({source:n.metadata.uid,target:a.metadata.uid}):console.log("Cannot found pods node!"),n.metadata.ownerReferences){var r=n.metadata.ownerReferences[0].uid,i=t.find(function(t){return t.metadata.uid===r});e.push({target:n.metadata.uid,source:i.metadata.uid})}else console.log("Cannot found owner references!");var o=t.find(function(t){if("Service"===t.kind&&t.spec.selector)return t.spec.selector.run===n.metadata.labels.run});e.push({target:n.metadata.uid,source:o.metadata.uid})}(),"Service"===f);}catch(t){h=!0,m=t}finally{try{!p&&y.return&&y.return()}finally{if(h)throw m}}return{items:n,relations:e}}d3.hive={},d3.hive.link=function(){function t(t,r){var i,o=e(n,this,t,r),c=e(a,this,t,r);c.a<o.a&&(i=c,c=o,o=i),c.a-o.a>Math.PI&&(o.a+=2*Math.PI);var s=o.a+(c.a-o.a)/3,d=c.a-(c.a-o.a)/3;return o.r0-o.r1||c.r0-c.r1?"M"+Math.cos(o.a)*o.r0+","+Math.sin(o.a)*o.r0+"L"+Math.cos(o.a)*o.r1+","+Math.sin(o.a)*o.r1+"C"+Math.cos(s)*o.r1+","+Math.sin(s)*o.r1+" "+Math.cos(d)*c.r1+","+Math.sin(d)*c.r1+" "+Math.cos(c.a)*c.r1+","+Math.sin(c.a)*c.r1+"L"+Math.cos(c.a)*c.r0+","+Math.sin(c.a)*c.r0+"C"+Math.cos(d)*c.r0+","+Math.sin(d)*c.r0+" "+Math.cos(s)*o.r0+","+Math.sin(s)*o.r0+" "+Math.cos(o.a)*o.r0+","+Math.sin(o.a)*o.r0:"M"+Math.cos(o.a)*o.r0+","+Math.sin(o.a)*o.r0+"C"+Math.cos(s)*o.r1+","+Math.sin(s)*o.r1+" "+Math.cos(d)*c.r1+","+Math.sin(d)*c.r1+" "+Math.cos(c.a)*c.r1+","+Math.sin(c.a)*c.r1}function e(t,e,n,a){var s=t.call(e,n,a),d=+("function"==typeof r?r.call(e,s,a):r)+c,l=+("function"==typeof i?i.call(e,s,a):i);return{r0:l,r1:i===o?l:+("function"==typeof o?o.call(e,s,a):o),a:d}}var n=function(t){return t.source},a=function(t){return t.target},r=function(t){return t.angle},i=function(t){return t.radius},o=i,c=0;return t.source=function(e){return arguments.length?(n=e,t):n},t.target=function(e){return arguments.length?(a=e,t):a},t.angle=function(e){return arguments.length?(r=e,t):r},t.radius=function(e){return arguments.length?(i=o=e,t):i},t.startRadius=function(e){return arguments.length?(i=e,t):i},t.endRadius=function(e){return arguments.length?(o=e,t):o},t};var cache={},K8SVisualisations=function(t){return t.forcedChart=t.forcedChart||{},t.forcedChart.init=function(t,e,n){function a(t){c.select(t)}function r(t){return o[t.item.kind]}function i(t){var e=t.item.status;return!(!e||!e.phase||"Running"===e.phase)}if(n=n||{},!e)throw new Error("Cannot init K8S forced layout chart visualisation, invalid data given "+e);var o=(d3.select(t),{Pod:"#vertex-Pod",ReplicationController:"#vertex-ReplicationController",Node:"#vertex-Node",Service:"#vertex-Service",ReplicaSet:"#vertex-ReplicaSet",Container:"#vertex-Container",Deployment:"#vertex-Deployment",Namespace:"#vertex-Namespace"}),c=topology_graph(t,a,{kinds:o});!function(t){var e=t[0],a=t[1];a.attr("class",function(t){return t.item.kind}),a.append("use").attr("xlink:href",r),a.append("title"),n.hasOwnProperty("nodeClickFn")&&"function"==typeof n.nodeClickFn&&e.on("click",n.nodeClickFn),e.selectAll("title").text(function(t){return t.item.metadata.name}),e.classed("weak",i),c.select()}(c.data(e.items,e.relations))},t}(K8SVisualisations||{}),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Math.radians=function(t){return t*Math.PI/180},Math.degrees=function(t){return 180*t/Math.PI};var K8SVisualisations=function(t){return t.hiveChart=t.hiveChart||{},t.hiveChart.init=function(t,e,n){if(n=n||{},!e)throw new Error("Cannot init K8S hive chart visualisation, invalid data given "+e);var a=n.width||960,r=n.height||600,i=n.outerRadius||400,o=n.innerRadius||40,c=[{x:0,angle:30,radius:420,name:"Pods",kind:"Pod"},{x:1,angle:270,radius:200,name:"Nodes",kind:"Node"},{x:2,angle:150,radius:240,name:"Services",kind:"Service"},{x:3,angle:210,radius:240,name:"Deployments",kind:"Deployment"},{x:4,angle:90,radius:240,name:"Namespaces",kind:"Namespace"}],s={Pod:"",Node:"",Service:"",Deployment:"",Namespace:"",Container:""},d={Pod:"FontAwesome",Node:"PatternFlyIcons-webfont",Service:"PatternFlyIcons-webfont",Deployment:"PatternFlyIcons-webfont",Namespace:"FontAwesome",Container:"PatternFlyIcons-webfont"},l={Pod:"#1186C1",Node:"#636363",Service:"#ff7f0e",Deployment:"#9467bd",Namespace:"gray",Container:"#ff7f0e"},u={Pod:0,Node:0,Service:0,Deployment:0,Namespace:0,Container:0},f={Pod:0,Node:1,Service:2,Deployment:3,Namespace:4,Container:5},p={Pod:d3.scale.linear().range([o,420]),Node:d3.scale.linear().range([o,200]),Service:d3.scale.linear().range([o,240]),Deployment:d3.scale.linear().range([o,240]),Namespace:d3.scale.linear().range([o,240])};"object"===_typeof(e.items)&&(e.items=Object.values(e.items));var h=function(t){return t.map(function(t){return t.id=t.metadata.uid,t.name=t.metadata.name||"Unnamed node",["Pod","Service","Node","Deployment","Namespace"].indexOf(t.kind)<0&&(t.kind="Other"),t.x=f[t.kind],u[t.kind]++,t.y=u[t.kind],t})}(e.items),m={Service:1/u.Service,Pod:1/u.Pod,Node:1/u.Node,Deployment:1/u.Deployment,Namespace:1/u.Namespace},v=function(t,e){return e.map(function(e){var n={};return t.forEach(function(t){e.source==t.id?n.source=t:e.target==t.id&&(n.target=t)}),n.hasOwnProperty("source")&&n.hasOwnProperty("target")||(console.log("Cannot found relation node for link "+e),n=e),n})}(h,e.relations),y=function(t){var e=0,n=!1;return c.forEach(function(a){t.kind==a.kind&&(e=a.angle,n=!0)}),n||console.log("Cannot compute angle for item "+t.kind+t.metadata.name),e},g=(d3.scale.linear().range([o,i]),function(t){return s[t]}),x=function(t){return l[t]},k={linkOver:function(t){M.selectAll(".link").classed("active",function(e){return e===t}),M.selectAll(".node circle").classed("active",function(e){return e===t.source||e===t.target}),M.selectAll(".node text").classed("active",function(e){return e===t.source||e===t.target})},nodeOver:function(t){M.selectAll(".link").classed("active",function(e){return e.source===t||e.target===t}),d3.select(this).select("circle").classed("active",!0),d3.select(this).select("text").classed("active",!0),w.html("Node - "+t.name+"<br/>Kind - "+t.kind).style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px"),w.transition().duration(200).style("opacity",.9)},out:function(t){M.selectAll(".active").classed("active",!1),w.transition().duration(500).style("opacity",0)}},M=d3.select(t).append("svg").attr("width",a).attr("height",r).append("g").attr("transform","translate("+(a/2-180)+","+(r/2-20)+")"),w=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),C=M.selectAll(".node").data(c).enter().append("g");C.append("line").attr("class","axis").attr("transform",function(t){return"rotate("+t.angle+")"}).attr("x1",function(t){return p[t.kind].range()[0]}).attr("x2",function(t){return p[t.kind].range()[1]}),C.append("text").attr("class","axis-label").attr("font-size","16px").attr("font-family","Open Sans").attr("text-anchor","middle").attr("alignment-baseline","central").text(function(t){return t.name}).attr("transform",function(t){return"translate("+(p[t.kind].range()[1]+30)*Math.cos(Math.radians(t.angle))+", "+(p[t.kind].range()[1]+30)*Math.sin(Math.radians(t.angle))+")"}),M.selectAll(".link").data(v).enter().append("path").attr("class","link").attr("d",d3.hive.link().angle(function(t){return Math.radians(y(t))}).radius(function(t){return p[t.kind](t.y*m[t.kind]-.1)})).on("mouseover",k.linkOver).on("mouseout",k.out);var S=M.selectAll(".node").data(h).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+p[t.kind](t.y*m[t.kind]-.1)*Math.cos(Math.radians(y(t)))+", "+p[t.kind](t.y*m[t.kind]-.1)*Math.sin(Math.radians(y(t)))+")"}).on("mouseover",k.nodeOver).on("mouseout",k.out);n.hasOwnProperty("nodeClickFn")&&"function"==typeof n.nodeClickFn&&S.on("click",n.nodeClickFn),S.append("circle").attr("r",15),S.append("text").attr("font-family",function(t){return d[t.kind]}).style("stroke",function(t){return x(t.kind)}).style("fill",function(t){return x(t.kind)}).attr("font-size",function(t){return"18px"}).text(function(t){return g(t.kind)}).attr("x","-10px").attr("y","5px")},t}(K8SVisualisations||{});